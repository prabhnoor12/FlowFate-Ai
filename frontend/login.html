<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - FlowFate AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      body {
        background: linear-gradient(to bottom, #cfe9ff, #ffffff);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Segoe UI", sans-serif;
      }
      .login-card {
        width: 100%;
        max-width: 400px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 20px;
        padding: 1.3rem 2rem 1.3rem 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        margin-top: 40px;
        margin-bottom: 40px;
      }
      .login-card input {
        border-radius: 10px;
      }
      .logo {
        font-weight: 700;
        font-size: 1.5rem;
        margin-bottom: 30px;
      }
      .form-control::placeholder {
        color: #999;
      }
      .google-signin-container {
        margin: 2rem 0;
        text-align: center;
      }
      .google-btn {
        max-width: 340px;
        font-weight: 500;
        font-size: 1.08rem;
      }
      .google-icon {
        width: 28px;
        height: 28px;
        margin-right: 10px;
      }
    </style>
</head>
<body>
    <div class="login-card text-center">
      <div class="mb-4">
        <img src="https://cdn-icons-png.flaticon.com/512/5087/5087579.png" width="40" alt="Sign In Icon">
      </div>
      <h5 class="mb-2">Login with email</h5>
      <p class="text-muted small mb-4">Access your workspace and bring your words, data, and teams together.</p>
      <form id="login-form" autocomplete="off">
        <div class="mb-3 text-start">
          <label for="email" class="form-label">Email</label>
          <input type="email" class="form-control" id="email" placeholder="you@example.com" required>
        </div>
        <div class="mb-3 text-start position-relative">
          <label for="password" class="form-label">Password</label>
          <input type="password" class="form-control" id="password" placeholder="Enter your password" required>
        </div>
        <div id="login-message" class="alert alert-danger py-2 d-none"></div>
        <button type="submit" class="btn btn-dark w-100 rounded-pill" id="login-btn">Login</button>
      </form>
      <hr class="my-4">
      <div class="google-signin-container">
        <div id="g_id_onload"
             data-client_id="1039150943893-1hqqcde9l35mnsf5bagti9r64sb06q6k.apps.googleusercontent.com"
             data-callback="handleCredentialResponse"
             data-auto_prompt="false">
        </div>
        <div class="g_id_signin"
             data-type="standard"
             data-size="large"
             data-theme="outline"
             data-text="login_with"
             data-shape="rect"
             data-logo_alignment="left">
        </div>
      </div>
      <div class="signup-link">
        Don't have an account? <a href="signup.html">Sign Up</a>
      </div>
    </div>
    <script>
  const BACKEND_BASE_URL = 'https://flowfate-ai.onrender.com';

  // Handle login form submission
  document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const errorDiv = document.getElementById('login-message');
    errorDiv.classList.add('d-none');
    errorDiv.textContent = '';
    if (!email || !password) {
      errorDiv.textContent = 'Both fields are required.';
      errorDiv.classList.remove('d-none');
      return;
    }
    document.getElementById('login-btn').disabled = true;
    try {
      const res = await fetch(`${BACKEND_BASE_URL}/api/auth/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (res.ok && data.token) {
        localStorage.setItem('token', data.token);
        errorDiv.textContent = 'Login successful! Opening chat...';
        errorDiv.classList.remove('d-none');
        errorDiv.classList.remove('alert-danger');
        errorDiv.classList.add('alert-success');
        setTimeout(() => {
          window.open('aiInterface.html', '_blank');
        }, 800);
      } else {
        errorDiv.textContent = data.message || 'Login failed. Please try again.';
        errorDiv.classList.remove('d-none');
        errorDiv.classList.remove('alert-success');
        errorDiv.classList.add('alert-danger');
      }
    } catch (err) {
      errorDiv.textContent = 'Network error. Please try again.';
      errorDiv.classList.remove('d-none');
      errorDiv.classList.remove('alert-success');
      errorDiv.classList.add('alert-danger');
    } finally {
      document.getElementById('login-btn').disabled = false;
    }
  });

  // Google One Tap/Sign-In
  async function handleCredentialResponse(response) {
    const errorDiv = document.getElementById('login-message');
    errorDiv.classList.add('d-none');
    errorDiv.textContent = '';
    try {
      const res = await fetch(`${BACKEND_BASE_URL}/api/auth/google`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: response.credential })
      });
      const data = await res.json();
      if (res.ok && data.token) {
        localStorage.setItem('token', data.token);
        errorDiv.textContent = 'Login successful! Opening chat...';
        errorDiv.classList.remove('d-none');
        errorDiv.classList.remove('alert-danger');
        errorDiv.classList.add('alert-success');
        setTimeout(() => {
          window.open('aiInterface.html', '_blank');
        }, 800);
      } else {
        errorDiv.textContent = (data && data.error) || 'Google login failed.';
        errorDiv.classList.remove('d-none');
        errorDiv.classList.remove('alert-success');
        errorDiv.classList.add('alert-danger');
      }
    } catch (err) {
      errorDiv.textContent = 'Google login error. Please try again.';
      errorDiv.classList.remove('d-none');
      errorDiv.classList.remove('alert-success');
      errorDiv.classList.add('alert-danger');
    }
  }
    </script>
</body>
</html>
