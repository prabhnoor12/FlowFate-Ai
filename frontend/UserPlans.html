<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Plans • FlowFate AI</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = { theme: { extend: { colors: { brand: { 50:'#f3fbf6',100:'#dcfce7',500:'#10b981',600:'#059669',700:'#047857' } } } } };
	</script>
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
	<style>
		body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
		.plan-card[data-active="true"] { box-shadow: 0 8px 28px -4px rgba(16,185,129,.35), 0 4px 12px -2px rgba(16,185,129,.25); border-color:#059669; }
		.sr-only { position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0; }
		.focus-ring:focus { outline:2px solid transparent;outline-offset:2px;box-shadow:0 0 0 2px #10b981,0 0 0 4px rgba(255,255,255,.9); }
	</style>
</head>
<body class="h-full bg-gray-50 text-gray-800">
	<a href="#main" class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2 focus:bg-white focus:text-brand-600 focus:px-4 focus:py-2 focus:rounded focus:shadow">Skip to main</a>
	<header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b border-gray-200">
		<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-14 flex items-center justify-between">
			<div class="flex items-center gap-3">
				<div class="w-9 h-9 rounded-lg bg-gradient-to-br from-brand-600 to-brand-500 grid place-items-center text-white font-bold">AI</div>
				<h1 class="text-lg font-semibold">Choose Your Plan</h1>
			</div>
			<nav class="hidden sm:flex gap-6 text-sm text-gray-600">
				<a href="Dashboard.html" class="hover:text-gray-900">Dashboard</a>
				<a href="userProfile.html" class="hover:text-gray-900">Profile</a>
			</nav>
		</div>
	</header>

	<main id="main" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-10" tabindex="-1">
		<section class="text-center max-w-3xl mx-auto">
			<h2 class="text-3xl font-semibold tracking-tight">Flexible pricing that scales like GitHub</h2>
			<p class="mt-3 text-sm text-gray-500">Pick a plan now. Upgrade or downgrade anytime. Basic exposes roughly <strong>20%</strong> of core automation & integrations. Pro unlocks all standard capabilities. Enterprise (spelled "interprice" in older UI) provides everything Pro has plus advanced controls & support at the <span class="font-medium">same base rate</span> &mdash; usage based like GitHub's seat & feature add‑ons.</p>
		</section>

		<!-- Alert / messages -->
		<div id="globalAlert" class="hidden max-w-xl mx-auto rounded-lg border px-4 py-3 text-sm"></div>

		<form id="planForm" class="grid gap-8 md:grid-cols-3" aria-labelledby="plan-options-heading">
			<h3 id="plan-options-heading" class="sr-only">Plan options</h3>

			<!-- BASIC -->
			<label class="relative group cursor-pointer">
				<input class="sr-only peer" type="radio" name="plan" value="basic" />
				<div class="plan-card h-full flex flex-col rounded-2xl border border-gray-200 bg-white p-6 transition-all peer-focus-visible:outline-none peer-focus-visible:ring-2 peer-focus-visible:ring-brand-500 peer-checked:border-brand-600 peer-checked:ring-1 peer-checked:ring-brand-600">
					<div class="flex items-center justify-between mb-4">
						<span class="text-sm font-semibold">Basic</span>
						<span class="text-xs bg-gray-100 text-gray-600 rounded-full px-2 py-0.5">20% features</span>
					</div>
					<div class="mb-4">
						<span class="text-3xl font-bold tracking-tight">$20</span><span class="text-sm text-gray-500">/mo</span>
					</div>
					<ul class="space-y-2 text-xs text-gray-600 flex-1">
						<li class="flex gap-2"><span class="text-green-500">✔</span> Up to 3 active automations</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> 2 integrations (e.g. Slack + Notion)</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Community support</li>
						<li class="flex gap-2"><span class="text-gray-400">✖</span> Advanced scheduling</li>
						<li class="flex gap-2"><span class="text-gray-400">✖</span> Priority processing</li>
					</ul>
					<div class="mt-6">
						<span class="inline-flex items-center rounded-md bg-gray-100 px-2 py-1 text-[10px] font-medium text-gray-600 tracking-wide uppercase">Starter</span>
					</div>
				</div>
				<span class="pointer-events-none absolute inset-0 rounded-2xl ring-0 ring-brand-500/0 peer-checked:ring-4 peer-checked:ring-brand-500/20 transition"></span>
			</label>

			<!-- PRO -->
			<label class="relative group cursor-pointer">
				<input class="sr-only peer" type="radio" name="plan" value="pro" />
				<div class="plan-card h-full flex flex-col rounded-2xl border border-gray-200 bg-gradient-to-b from-white to-brand-50/40 p-6 transition-all peer-focus-visible:outline-none peer-focus-visible:ring-2 peer-focus-visible:ring-brand-500 peer-checked:border-brand-600 peer-checked:ring-1 peer-checked:ring-brand-600">
					<div class="flex items-center justify-between mb-4">
						<span class="text-sm font-semibold">Pro</span>
						<span class="text-xs bg-brand-100 text-brand-700 rounded-full px-2 py-0.5">Full features</span>
					</div>
					<div class="mb-4">
						<span class="text-3xl font-bold tracking-tight">$40</span><span class="text-sm text-gray-500">/mo</span>
					</div>
					<ul class="space-y-2 text-xs text-gray-700 flex-1">
						<li class="flex gap-2"><span class="text-green-500">✔</span> Unlimited automations</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> All standard integrations</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Advanced scheduling</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Priority processing</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Email support SLA</li>
					</ul>
					<div class="mt-6">
						<span class="inline-flex items-center gap-1 rounded-md bg-brand-600 px-2 py-1 text-[10px] font-medium text-white tracking-wide uppercase">Most Popular</span>
					</div>
				</div>
				<span class="pointer-events-none absolute inset-0 rounded-2xl ring-0 ring-brand-500/0 peer-checked:ring-4 peer-checked:ring-brand-500/30 transition"></span>
			</label>

			<!-- ENTERPRISE -->
			<label class="relative group cursor-pointer">
				<input class="sr-only peer" type="radio" name="plan" value="enterprise" />
				<div class="plan-card h-full flex flex-col rounded-2xl border border-gray-200 bg-white p-6 transition-all peer-focus-visible:outline-none peer-focus-visible:ring-2 peer-focus-visible:ring-brand-500 peer-checked:border-brand-600 peer-checked:ring-1 peer-checked:ring-brand-600">
					<div class="flex items-center justify-between mb-4">
						<span class="text-sm font-semibold">Enterprise</span>
						<span class="text-xs bg-gray-900 text-white rounded-full px-2 py-0.5">Pro +</span>
					</div>
					<div class="mb-4">
						<span class="text-3xl font-bold tracking-tight">$40</span><span class="text-sm text-gray-500">/mo base</span>
					</div>
					<ul class="space-y-2 text-xs text-gray-600 flex-1">
						<li class="flex gap-2"><span class="text-green-500">✔</span> Everything in Pro</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> SSO / governance (future)</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Role-based controls</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Premium support channel</li>
						<li class="flex gap-2"><span class="text-green-500">✔</span> Usage-based scaling (GitHub style)</li>
					</ul>
					<div class="mt-6">
						<span class="inline-flex items-center rounded-md bg-gray-900 px-2 py-1 text-[10px] font-medium text-white tracking-wide uppercase">For Teams</span>
					</div>
				</div>
				<span class="pointer-events-none absolute inset-0 rounded-2xl ring-0 ring-brand-500/0 peer-checked:ring-4 peer-checked:ring-brand-500/20 transition"></span>
			</label>
		</form>

		<!-- Billing / Seats -->
		<section class="max-w-4xl mx-auto mt-4 bg-white border border-gray-200 rounded-2xl shadow-sm p-6 space-y-6" aria-labelledby="billing-heading">
			<h3 id="billing-heading" class="text-lg font-semibold flex items-center gap-2">Billing & Seats <span class="text-xs font-normal text-gray-500">(estimates)</span></h3>
			<div class="grid md:grid-cols-2 gap-8">
				<div class="space-y-5">
					<div>
						<label for="seatRange" class="flex items-center justify-between text-sm font-medium mb-2">
							<span>Seats</span>
							<span class="text-xs text-gray-500">Team members billed</span>
						</label>
						<div class="flex items-center gap-4">
							<input id="seatRange" type="range" min="1" max="100" value="1" class="w-full accent-brand-600" />
							<input id="seatInput" type="number" min="1" max="100" value="1" class="w-20 rounded-lg border border-gray-300 px-2 py-1 text-sm" />
						</div>
						<p id="seatHelper" class="mt-1 text-xs text-gray-500">1 seat active.</p>
					</div>

					<div class="grid grid-cols-2 gap-4 text-xs">
						<div class="p-4 rounded-xl border bg-gray-50">
							<div class="text-gray-500">Base (per seat)</div>
							<div id="basePerSeat" class="mt-1 text-sm font-semibold">$0</div>
						</div>
						<div class="p-4 rounded-xl border bg-gray-50">
							<div class="text-gray-500">Seats</div>
							<div id="seatCountDisplay" class="mt-1 text-sm font-semibold">1</div>
						</div>
						<div class="p-4 rounded-xl border bg-gray-50 col-span-2">
							<div class="flex items-center justify-between">
								<div>
									<div class="text-gray-500">Est. Monthly Total</div>
									<div id="monthlyTotal" class="mt-1 text-lg font-semibold tracking-tight">$0</div>
								</div>
								<div class="text-right">
									<div class="text-gray-500">Est. Annual (x12)</div>
									<div id="annualTotal" class="mt-1 text-sm font-medium">$0</div>
								</div>
							</div>
							<p class="mt-2 text-[11px] text-gray-500">Enterprise pricing uses Pro base; additional enterprise-only usage (e.g. governance) may be metered later.</p>
						</div>
					</div>
				</div>

				<div class="space-y-6">
					<div>
						<h4 class="text-sm font-semibold mb-3">Usage Metrics (Sample)</h4>
						<ul class="space-y-4" id="usageMetrics">
							<!-- Filled by JS -->
						</ul>
					</div>
					<div class="text-[11px] text-gray-500 leading-relaxed">Metrics are illustrative; connect real usage endpoints to replace these placeholders. Overages for future metered features (e.g. automation run volume) would appear here.</div>
				</div>
			</div>
		</section>

		<div class="max-w-2xl mx-auto text-center">
			<button id="saveBtn" class="mt-4 inline-flex items-center gap-2 rounded-lg bg-brand-600 text-white px-6 py-3 text-sm font-medium shadow hover:bg-brand-500 focus-ring disabled:opacity-50 disabled:cursor-not-allowed">Save Selection</button>
			<p class="mt-3 text-xs text-gray-500">Changing plan updates your user preferences immediately. Billing logic is illustrative only.</p>
		</div>

		<section class="max-w-4xl mx-auto grid gap-8 md:grid-cols-3">
			<div class="p-5 rounded-xl bg-white border shadow-sm">
				<h4 class="font-medium">Feature Coverage</h4>
				<p class="mt-2 text-xs text-gray-500">Approximate feature access percentage per plan.</p>
				<div class="mt-4 space-y-4 text-xs">
					<div>
						<div class="flex justify-between mb-1"><span>Basic</span><span>20%</span></div>
						<div class="h-2 rounded bg-gray-100 overflow-hidden"><div class="h-full w-1/5 bg-gradient-to-r from-brand-500 to-brand-600"></div></div>
					</div>
					<div>
						<div class="flex justify-between mb-1"><span>Pro</span><span>100%</span></div>
						<div class="h-2 rounded bg-gray-100 overflow-hidden"><div class="h-full w-full bg-gradient-to-r from-brand-500 to-brand-600"></div></div>
					</div>
					<div>
						<div class="flex justify-between mb-1"><span>Enterprise</span><span>100%+</span></div>
						<div class="h-2 rounded bg-gray-100 overflow-hidden"><div class="h-full w-full bg-gradient-to-r from-brand-600 to-gray-900"></div></div>
					</div>
				</div>
			</div>
			<div class="p-5 rounded-xl bg-white border shadow-sm md:col-span-2 flex flex-col">
				<h4 class="font-medium">Why Enterprise same base price?</h4>
				<p class="mt-2 text-xs text-gray-600 leading-relaxed">Similar to GitHub's approach where core functionality is available broadly, we keep the base rate aligned with Pro to reduce friction. Enterprise value emerges from governance, scale, and support layers (metered later). That means you can opt into Enterprise early without overpaying while advanced controls roll out.</p>
				<div class="mt-4 grid gap-3 sm:grid-cols-2 text-xs">
					<div class="flex gap-2"><span class="text-green-500">✔</span> Predictable budgeting & no paywall spikes</div>
					<div class="flex gap-2"><span class="text-green-500">✔</span> Immediate access to roadmap features</div>
					<div class="flex gap-2"><span class="text-green-500">✔</span> Seat / usage expansion friendly</div>
					<div class="flex gap-2"><span class="text-green-500">✔</span> Simplified procurement cycle</div>
				</div>
			</div>
		</section>
	</main>

	<footer class="mt-20 py-10 text-center text-xs text-gray-400">© <span id="year"></span> FlowFate AI</footer>

	<script>
		const BACKEND_BASE_URL = 'https://flowfate-ai.onrender.com';
		const token = localStorage.getItem('token');
		const alertEl = document.getElementById('globalAlert');
		const saveBtn = document.getElementById('saveBtn');
		const form = document.getElementById('planForm');
		const seatRange = document.getElementById('seatRange');
		const seatInput = document.getElementById('seatInput');
		const seatHelper = document.getElementById('seatHelper');
		const basePerSeatEl = document.getElementById('basePerSeat');
		const seatCountDisplay = document.getElementById('seatCountDisplay');
		const monthlyTotalEl = document.getElementById('monthlyTotal');
		const annualTotalEl = document.getElementById('annualTotal');
		const usageMetricsEl = document.getElementById('usageMetrics');
		document.getElementById('year').textContent = new Date().getFullYear();
		let originalPlan = null; let userData = null;
		let currentSeats = 1;
		const PLAN_PRICING = { basic: 20, pro: 40, enterprise: 40 };
		const USAGE_SAMPLE = [
			{ key: 'automationRuns', label: 'Automation Runs', used: 320, limit: 1000 },
			{ key: 'integrations', label: 'Integrations Connected', used: 4, limit: 10 },
			{ key: 'tasks', label: 'AI Tasks Executed', used: 1800, limit: 5000 },
			{ key: 'reminders', label: 'Reminders Scheduled', used: 45, limit: 200 },
		];

		function setAlert(msg, type='info') {
			alertEl.textContent = msg;
			alertEl.className = 'max-w-xl mx-auto rounded-lg border px-4 py-3 text-sm';
			const styles = { info:'border-gray-200 bg-white text-gray-700', success:'border-green-200 bg-green-50 text-green-700', error:'border-red-200 bg-red-50 text-red-700', warning:'border-amber-200 bg-amber-50 text-amber-700' };
			alertEl.classList.add(...styles[type].split(' '));
			alertEl.classList.remove('hidden');
		}
		function hideAlert(){ alertEl.classList.add('hidden'); }

		if (!token) {
			setAlert('Not authenticated. Redirecting...','error');
			setTimeout(()=> window.location.href='login.html', 1200);
		} else {
			loadUser();
		}

		async function loadUser(){
			try {
				setAlert('Loading current plan…','info');
				const res = await fetch(`${BACKEND_BASE_URL}/api/users/me`, { headers:{ 'Authorization':`Bearer ${token}` } });
				const json = await res.json();
				if(!res.ok) throw new Error(json?.error?.message || 'Failed to load user');
				userData = json.data;
				const plan = (userData.preferences && (userData.preferences.plan || userData.preferences.Plan)) || 'basic';
				currentSeats = parseInt(userData.preferences?.seats, 10) || 1;
				seatRange.value = seatInput.value = currentSeats;
				updateSeatHelper();
				originalPlan = plan;
				const input = form.querySelector(`input[value="${plan}"]`);
				if (input) { input.checked = true; activateCard(plan); }
				// If inbound desired plan via query parameter, apply override before user interacts
				const params = new URLSearchParams(window.location.search);
				const qpPlan = params.get('plan');
				if(qpPlan && ['basic','pro','enterprise'].includes(qpPlan) && qpPlan !== plan){
					const override = form.querySelector(`input[value="${qpPlan}"]`);
					if(override){ override.checked = true; activateCard(qpPlan); originalPlan = plan; setAlert(`Previewing ${qpPlan} plan — save to apply.`, 'info'); }
					// Focus save button for quick action
					setTimeout(()=> saveBtn.focus(), 50);
				}
				updateBillingFigures();
				renderUsageMetrics();
				setAlert('Loaded current plan.','success');
				setTimeout(hideAlert, 1400);
			} catch (e){ setAlert(e.message,'error'); }
		}

		form.addEventListener('change', (e) => {
			if (e.target.name === 'plan') activateCard(e.target.value);
		});

		function activateCard(plan){
			form.querySelectorAll('.plan-card').forEach(c => c.dataset.active = 'false');
			const checked = form.querySelector(`input[value="${plan}"]`);
			if (checked){ checked.parentElement.querySelector('.plan-card').dataset.active = 'true'; }
			updateBillingFigures();
		}

		function updateSeatHelper(){
			seatHelper.textContent = `${currentSeats} seat${currentSeats>1?'s':''} active.`;
		}

		function updateBillingFigures(){
			const plan = getSelectedPlan();
			const base = PLAN_PRICING[plan] || 0;
			basePerSeatEl.textContent = `$${base}`;
			seatCountDisplay.textContent = currentSeats;
			const monthly = base * currentSeats;
			monthlyTotalEl.textContent = `$${monthly.toLocaleString()}`;
			annualTotalEl.textContent = `$${(monthly*12).toLocaleString()}`;
		}

		function getSelectedPlan(){
			const selected = form.querySelector('input[name=plan]:checked');
			return selected? selected.value : 'basic';
		}

		function renderUsageMetrics(){
			usageMetricsEl.innerHTML = '';
			USAGE_SAMPLE.forEach(m => {
				const pct = Math.min(100, Math.round((m.used / m.limit) * 100));
				const li = document.createElement('li');
				li.innerHTML = `<div class="flex items-center justify-between mb-1"><span class="text-[11px] font-medium text-gray-600">${m.label}</span><span class="text-[11px] text-gray-500">${m.used}/${m.limit}</span></div><div class="h-2 rounded bg-gray-100 overflow-hidden"><div class="h-full bg-gradient-to-r from-brand-500 to-brand-600" style="width:${pct}%;"></div></div>`;
				usageMetricsEl.appendChild(li);
			});
		}

		seatRange.addEventListener('input', () => { currentSeats = parseInt(seatRange.value,10); seatInput.value = currentSeats; updateSeatHelper(); updateBillingFigures(); });
		seatInput.addEventListener('input', () => { let v = parseInt(seatInput.value,10); if(isNaN(v)||v<1) v=1; if(v>100) v=100; currentSeats = v; seatRange.value = v; updateSeatHelper(); updateBillingFigures(); });

		saveBtn.addEventListener('click', async () => {
			const selected = form.querySelector('input[name=plan]:checked');
			if(!selected) { setAlert('Select a plan first.','warning'); return; }
			const plan = selected.value;
			// allow saving if seat count changed even if plan same
			if (plan === originalPlan && currentSeats === (parseInt(userData?.preferences?.seats,10)||1)) { setAlert('No changes to save.','info'); return; }
			saveBtn.disabled = true; setAlert('Updating plan…','info');
			try {
				const mergedPrefs = Object.assign({}, userData?.preferences || {}, { plan, seats: currentSeats });
				const res = await fetch(`${BACKEND_BASE_URL}/api/users/me`, { method:'PUT', headers:{ 'Content-Type':'application/json','Authorization':`Bearer ${token}` }, body: JSON.stringify({ name:userData.name, email:userData.email, preferences: mergedPrefs }) });
				const json = await res.json();
				if(!res.ok) throw new Error(json?.error?.message || 'Plan update failed');
				userData = json.data; originalPlan = plan; activateCard(plan);
				userData.preferences.seats = currentSeats;
				setAlert('Plan updated successfully.','success');
				setTimeout(hideAlert, 1700);
			} catch(e){ setAlert(e.message,'error'); }
			finally { saveBtn.disabled = false; }
		});

		// Keyboard: Enter triggers save if a radio focused
		form.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); saveBtn.click(); }});
	</script>
</body>
</html>
